<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ROS ナビゲーションメタパッケージのリカバリ動作を自作する | ざきのメモ</title>
<link rel="stylesheet" href="style.css">
<link rel="icon" type="image/png" href="favicon.png">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=desert"></script>
</head>
<body>

<header>
<h1>ざきのメモ</h1>
</header>

<article>
<h4>2017/11/28</h4>
<h1>ROS ナビゲーションメタパッケージのリカバリ動作を自作する</h1>

<p>ROS のナビゲーションメタパッケージ（以下、ナビゲーションと呼びます）はロボットが自律移動するためのパッケージです。<br>
ナビゲーションは自己位置推定がうまくいかないときに、リカバリ動作を行います。<br>
このページでは、リカバリ動作を自作する方法を紹介します。</p>
                                  
<h2>環境</h2>
<li>Ubuntu 16.04</li>
<li>ROS Kinetic</li>

<h2>手順</h2>
<h3>1, ROSパッケージを作る</h3>
<p>ナビゲーションはメタパッケージなので複数のROSパッケージから構成されています。<br>
リカバリ動作もまたROSパッケージ単位で管理されることがほとんどです。<br>
なので、まず自作するリカバリ動作用のROSパッケージを作成します。<br>
今回は、go_forward_recovery という名前で直進するリカバリ動作を作っていきます。</p>
<pre class="prettyprint"><code>$ roscd ../src/navigation</code></pre>
<p>依存関係にはとりあえず roscpp を入れておきます。</p>
<pre class="prettyprint"><code>$ catkin_create_pkg go_forward_recovery roscpp</code></pre>
<p>はじめに、CMakeLists.txt を書き変えていきましょう。</p>
<pre class="prettyprint"><code>$ cd go_forward_recovery
$ vim CMakeLists.txt</code></pre>
<pre class="prettyprint"><code>cmake_minimum_required(VERSION 2.8.3)
project(go_forward_recovery)

find_package(catkin REQUIRED
        COMPONENTS
            cmake_modules
            roscpp
            tf
            costmap_2d
            nav_core
            pluginlib
            base_local_planner
        )

find_package(Eigen REQUIRED)
include_directories(
    include
    ${catkin_INCLUDE_DIRS}
    ${EIGEN_INCLUDE_DIRS}
)
add_definitions(${EIGEN_DEFINITIONS})

catkin_package(
    INCLUDE_DIRS include
    LIBRARIES go_forward_recovery
    CATKIN_DEPENDS
        roscpp
        pluginlib
)

add_library(go_forward_recovery src/go_forward_recovery.cpp)
target_link_libraries(go_forward_recovery ${catkin_LIBRARIES})

install(TARGETS go_forward_recovery
       ARCHIVE DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
       LIBRARY DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
       )

install(FILES recovery_plugin.xml
    DESTINATION ${CATKIN_PACKAGE_SHARE_DESTINATION}
)</code></pre>
<p>次に package.xml を書き換えましょう。</p>
<pre class="prettyprint"><code>$ vim package.xml</code></pre>
<pre class="prettyprint"><code>&lt;package&gt;
    &lt;name&gt;go_forward_recovery&lt;/name&gt;
    &lt;version&gt;1.12.13&lt;/version&gt;
    &lt;description&gt;

       *The description of recovery behavior. 

    &lt;/description&gt;
    &lt;author&gt;Eitan Marder-Eppstein&lt;/author&gt;
    &lt;author&gt;contradict@gmail.com&lt;/author&gt;
    &lt;author&gt;*your name&lt;/author&gt;
    &lt;maintainer email="*your e-mail address"&gt;*your name&lt;/maintainer&gt;
    &lt;license&gt;MIT&lt;/license&gt;
    &lt;url&gt;&lt;/url&gt;

    &lt;buildtool_depend&gt;catkin&lt;/buildtool_depend&gt;

    &lt;build_depend&gt;cmake_modules&lt;/build_depend&gt;
    &lt;build_depend&gt;roscpp&lt;/build_depend&gt;
    &lt;build_depend&gt;tf&lt;/build_depend&gt;
    &lt;build_depend&gt;costmap_2d&lt;/build_depend&gt;
    &lt;build_depend&gt;nav_core&lt;/build_depend&gt;
    &lt;build_depend&gt;pluginlib&lt;/build_depend&gt;
    &lt;build_depend&gt;eigen&lt;/build_depend&gt;
    &lt;build_depend&gt;base_local_planner&lt;/build_depend&gt;

    &lt;run_depend&gt;roscpp&lt;/run_depend&gt;
    &lt;run_depend&gt;tf&lt;/run_depend&gt;
    &lt;run_depend&gt;costmap_2d&lt;/run_depend&gt;
    &lt;run_depend&gt;nav_core&lt;/run_depend&gt;
    &lt;run_depend&gt;pluginlib&lt;/run_depend&gt;
    &lt;run_depend&gt;eigen&lt;/run_depend&gt;


    &lt;export&gt;
        &lt;nav_core plugin="${prefix}/recovery_plugin.xml" /&gt;
    &lt;/export&gt;

&lt;/package&gt;</code></pre>
<p>*印がついているものはそれぞれ書き入れてみて下さい。上からパッケージの概要, 著者の名前, 管理者のメールアドレスと名前です。</p>
<pre class="prettyprint"><code>$ </code></pre>
<pre class="prettyprint"><code>$ </code></pre>


<li><a href="index.html">トップへもどる</a></li>
</article>

<footer>
<small>Copyright &copy; Ryo Okazaki, all rights reserved.</small>
</footer>

</body>
</html>
